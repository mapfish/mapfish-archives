<!DOCTYPE html>
<html>
<head>
<title>Map printing with a simple form</title>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css"
      href="http://extjs.cachefly.net/ext-2.2.1/resources/css/ext-all.css"/>
<link rel="stylesheet" type="text/css"
      href="http://www.mapfish.org/svn/mapfish/trunk/MapFish/client/mfbase/mapfish/mapfish.css"/>

<script type="text/javascript"
        src="http://openlayers.org/api/OpenLayers.js"></script>

<script type="text/javascript"
        src="http://extjs.cachefly.net/builds/ext-cdn-771.js"></script>

<script type="text/javascript">
  // Because of a bug in Firefox 2 we need to specify the MapFish base path.
  // See https://bugzilla.mozilla.org/show_bug.cgi?id=351282
  var gMfLocation = "http://www.mapfish.org/svn/mapfish/trunk/MapFish/client/mfbase/mapfish/";
</script>
<script type="text/javascript" src="http://www.mapfish.org/svn/mapfish/trunk/MapFish/client/mfbase/mapfish/MapFish.js"></script>

<style type="text/css">
  html, body {
    font: normal 12px verdana;
    margin: 0;
    padding: 0;
    border: 0 none;
    overflow: hidden;
    height: 100%;
  }
</style>
<script type="text/javascript">

  // mapfish base url for print widget
  mapfish.SERVER_BASE_URL = '../../';
  // reference local blank image
  Ext.BLANK_IMAGE_URL = 'http://www.mapfish.org/svn/mapfish/trunk/MapFish/client/mfbase/ext/resources/images/default/s.gif';
  Ext.onReady(function() {

    var map = new OpenLayers.Map($('center'));

    var wms = new OpenLayers.Layer.WMS("OpenLayers WMS",
            "http://labs.metacarta.com/wms/vmap0", {layers: 'basic'}, {buffer: 0});
    map.addLayers([wms]);

    var layerOverrides={
        "OpenLayers WMS": {overview: true}
    };

    var printConfigUrl = mapfish.SERVER_BASE_URL + 'print/info.json';

    var toolbar = new mapfish.widgets.toolbar.Toolbar({
        map: map,
        configurable: false,
        items: [new mapfish.widgets.print.PrintAction({
            map: map,
            configUrl: printConfigUrl,
            overrides: layerOverrides,
	    iconCls: '',
            fillSpec: function(printCommand) {
                mapfish.widgets.print.PrintAction.prototype.fillSpec.call(this, printCommand);

                //our layout needs two fields... hard code them here
                printCommand.spec.comment = "No comment";
                printCommand.spec.mapTitle = "PrintControl";
            }
        })]
    });

    var viewport = new Ext.Viewport({
      layout:'border',
      items:[
        new Ext.BoxComponent({ // raw
          region: 'north',
          el: 'north',
          height: 32
        }),
        {
          region: 'west',
          id: 'west-panel',
          title: 'West',
          split: true,
          width: 280,
          minSize: 175,
          maxSize: 400,
          collapsible: true,
          margins: '0 0 0 5',
          layout: 'accordion',
          defaults: {
            collapsed: true
          },
          layoutConfig:{
            animate: true,
            activeOnTop: false
          },
          items: [
            {
              xtype: 'print-simple',
              title: 'Print single page',
              bodyStyle: 'padding: 7px;',
	      collapsed: false,
              formConfig: {
                labelWidth: 65,
                defaults: {
                  width: 140,
                  listWidth: 140
                },
                items: [
                  {
                    xtype: 'textfield',
                    fieldLabel: OpenLayers.Lang.translate('mf.print.mapTitle'),
                    name: 'mapTitle',
                    value: 'Map title'
                  },
                  {
                    xtype: 'textarea',
                    fieldLabel: OpenLayers.Lang.translate('mf.print.comment'),
                    name: 'comment',
                    height: 100,
                    value: 'Some comments'
                  }
                ]
              },
              border: false,
              map: map,
              configUrl: printConfigUrl,
              overrides: layerOverrides
            }
          ]
        },{
            region: 'center',
            title: 'Map',
            layout: 'fit',
            xtype: 'mapcomponent',
            map: map,
            tbar: toolbar
        }]
    });

    map.setCenter(new OpenLayers.LonLat(8.5, 0), 3);
  });
</script>
</head>
<body>
  <div id="west"></div>
  <div id="north">
    <p style="font-size:14pt" align="center">MapFish printer</p>
  </div>
  <div id="center"></div>
</body>
</html>
