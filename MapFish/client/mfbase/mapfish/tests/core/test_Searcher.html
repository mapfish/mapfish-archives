<!DOCTYPE html>
<html debug="true">
  <head>
    <link rel="stylesheet" type="text/css" href="../../ext/resources/css/ext-all.css" />

    <script type="text/javascript" src="../../../openlayers/lib/Firebug/firebug.js"></script>
    <script type="text/javascript" src="../../../openlayers/lib/OpenLayers.js"></script>

    <script type="text/javascript" src="../../../ext/adapter/ext/ext-base.js"></script>
    <script type="text/javascript" src="../../../ext/ext-all-debug.js"></script>

    <script type="text/javascript">
      // Because of a bug in Firefox 2 we need to specify the MapFish base path.
      // See https://bugzilla.mozilla.org/show_bug.cgi?id=351282
      var gMfLocation = "../../../mapfish/";
    </script>
    <script type="text/javascript" src="../../../mapfish/MapFish.js"></script>

    <script type="text/javascript"><!--

    function test_Searcher_initialize(t) {
        t.plan(6);

        // 3 tests
        var searcher = new mapfish.Searcher();
        t.eq(searcher.enabled, false,
             "ctor does not enable searcher");
        t.eq(searcher.mediator.CLASS_NAME, "mapfish.SearchMediator",
             "ctor creates a default mediator");
        t.ok(typeof searcher.mediator.callback == "function",
             "ctor creates a default callback");
        t.ok(searcher.mediator.searchers[0] == searcher,
             "ctor register searcher with mediator");

        // 1 test
        var searcher = new mapfish.Searcher(null, {"a": "a"});
        t.eq(searcher.a, "a",
             "ctor sets options in object");

        // 1 test
        var mediator = new mapfish.SearchMediator();
        mediator.setOptions = function() {
            t.ok(true, "mediator setOptions called");
        };
        var searcher = new mapfish.Searcher(mediator, null, {
            "url": "url"
        });
    }

    function test_Searcher_enable(t) {
        t.plan(4);

        var searcher = new mapfish.Searcher();

        var ret;

        // 2 tests
        ret = searcher.enable();
        t.eq(searcher.enabled, true,
             "enable sets enabled prop to true");
        t.eq(ret, true,
             "enable returns true when searcher was not already enabled");

        // 2 tests
        ret = searcher.enable();
        t.eq(searcher.enabled, true,
             "enable sets enabled prop to true");
        t.eq(ret, false,
             "enable returns false when searcher was already enabled");
    }

    function test_Searcher_disable(t) {
        t.plan(4);

        var searcher = new mapfish.Searcher();
        searcher.enable();

        var ret;

        // 2 tests
        ret = searcher.disable();
        t.eq(searcher.enabled, false,
             "disable sets enabled prop to false");
        t.eq(ret, true,
             "disables returns true when searcher was not already disabled");

        // 2 tests
        ret = searcher.disable();
        t.eq(searcher.enabled, false,
             "disable sets enabled prop to false");
        t.eq(ret, false,
             "disable returns false when searcher was already disabled");
    }

    function test_Searcher_doSearch(t) {
        t.plan(2);

        var mediator = new mapfish.SearchMediator();
        var searcher = new mapfish.Searcher(mediator);

        var params = {"fake": "params"};

        mediator.doSearch = function(s, p) {
            t.ok(s == searcher,
                 "doSearch passes correct searcher to mediator");
            t.ok(p == params,
                 "doSearch passes correct params to mediator");
        };

        // 2 tests
        searcher.doSearch(params);
    }

    function test_Searcher_cancelSearch(t) {
        t.plan(1);

        var mediator = new mapfish.SearchMediator();
        var searcher = new mapfish.Searcher(mediator);

        mediator.cancelSearch = function() {
            t.ok(true,
                 "mediator cancelSearch called");
        };

        // 1 test
        searcher.cancelSearch();
    }
--></script>

  </head>
  <body>
  </body>
</html>
