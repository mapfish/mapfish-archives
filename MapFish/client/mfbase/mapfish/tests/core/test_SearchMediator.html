<!DOCTYPE html>
<html debug="true">
  <head>
    <link rel="stylesheet" type="text/css" href="../../ext/resources/css/ext-all.css" />

    <script type="text/javascript" src="../../../openlayers/lib/Firebug/firebug.js"></script>
    <script type="text/javascript" src="../../../openlayers/lib/OpenLayers.js"></script>

    <script type="text/javascript" src="../../../ext/adapter/ext/ext-base.js"></script>
    <script type="text/javascript" src="../../../ext/ext-all-debug.js"></script>

    <script type="text/javascript">
      // Because of a bug in Firefox 2 we need to specify the MapFish base path.
      // See https://bugzilla.mozilla.org/show_bug.cgi?id=351282
      var gMfLocation = "../../../mapfish/";
    </script>
    <script type="text/javascript" src="../../../mapfish/MapFish.js"></script>

    <script type="text/javascript"><!--

    function test_SearchMediator_initialize(t) {
        t.plan(1);

        // setup
       
        var mediator;

        mediator = new mapfish.SearchMediator();

        // 2 test
        t.ok(mediator.events instanceof OpenLayers.Events,
             "initialize sets events property");
    }

    function test_SearchMediator_cancelSearch(t) {
        t.plan(3);

        // setup
       
        var mediator;
        var response = new OpenLayers.Protocol.Response({
            priv: {
                abort: function() {
                    t.ok(true, "request.abort called");
                }
            }
       });

        mediator = new mapfish.SearchMediator({
            eventListeners: {
                searchcanceled: function(resp) {
                    t.ok(resp == response,
                         "searchcanceled listener called with " +
                         "expected response object");
                }
            }
        });

        // 0 test
        mediator.response = null;
        mediator.cancelSearch();

        // 3 tests
        mediator.response = response;
        mediator.cancelSearch();
        t.eq(mediator.response, null,
             "cancelSearch sets this.response to null");

        // 0 test
        mediator.response = response;
        mediator.finishSearch();
        mediator.cancelSearch();
    }

    function test_SearchMediator_toFilter(t) {
        t.plan(10);

        // setup

        var mediator, filter0, filter1, obj;

        mediator = new mapfish.SearchMediator();

        // 4 tests
        obj = {a: "a", b: "b"};
        filter0 = mediator.toFilter(obj);
        t.eq(filter0.CLASS_NAME, "OpenLayers.Filter.Logical",
             "toFilter returns a logical filter");
        t.eq(filter0.filters.length, 2,
             "toFilter returns a logical filter with expected " +
             "number of filters");
        t.eq(filter0.filters[0].CLASS_NAME, "OpenLayers.Filter.Comparison",
             "toFilter returns a logical filter whose first filter " +
             "is a comparison filter");
        t.eq(filter0.filters[1].CLASS_NAME, "OpenLayers.Filter.Comparison",
             "toFilter returns a logical filter whose second filter " +
             "is a comparison filter");

        // 3 tests
        obj = new OpenLayers.Filter();
        filter0 = mediator.toFilter(obj);
        t.eq(filter0.CLASS_NAME, "OpenLayers.Filter.Logical",
             "toFilter returns a logical filter");
        t.eq(filter0.filters.length, 1,
             "toFilter returns a logical filter with expected " +
             "number of filters");
        t.ok(filter0.filters[0] == obj,
             "toFilter returns a logical filter whose first filter " +
             "is the expected one");

        // 3 tests
        filter0 = new OpenLayers.Filter.Logical(
            {type: OpenLayers.Filter.Logical.AND});
        obj = new OpenLayers.Filter();
        filter1 = mediator.toFilter(obj, filter0);
        t.ok(filter1 == filter0,
             "toFilter returns expected filter");
        t.eq(filter1.filters.length, 1,
             "toFilter returns a logical filter with expected " +
             "number of filters");
        t.ok(filter1.filters[0] == obj,
             "toFilter returns a logical filter whose first filter " +
             "is the expected one");
    }

    function test_SearchMediator_isFilter(t) {
        t.plan(3);

        // setup

        var mediator, obj, bool;

        mediator = new mapfish.SearchMediator();

        // 1 test
        obj = {fake: "object"};
        bool = mediator.isFilter(obj);
        t.eq(bool, false,
             "isFilter returns expected value");

        // 1 test
        obj = new OpenLayers.Filter();
        bool = mediator.isFilter(obj);
        t.eq(bool, true,
             "isFilter returns expected value");

        // 1 test
        obj = new OpenLayers.Filter.Spatial();
        bool = mediator.isFilter(obj);
        t.eq(bool, true,
             "isFilter returns expected value");
    }
--></script>

  </head>
  <body>
  </body>
</html>
