<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>MapFish GeoStat demo</title>
    <script type="text/javascript" src="../../mfbase/release/mapfish/openlayers/OpenLayers.js"></script>
    <script>
      // There's a bug in Firefox 2.0 (and less?) which will prevent dojo from
      // loading parameters from the script element, and guessing the baseUrl
      // https://bugzilla.mozilla.org/show_bug.cgi?id=351282
      var djConfig = {baseUrl: "../../cwbase/dojo/",
                      parseOnLoad: true};
      // TODO: remove once migrated
      var gMfLocation = "../../mfbase/";
    </script>
 
    <script type="text/javascript" src="../../cwbase/release/mapfish/dojo/dojo.js"></script>
    <script type="text/javascript" src="../../cwbase/release/mapfish/dijit/dijit.js"></script>

    <link rel="stylesheet" type="text/css" href="../../mfbase/ext/resources/css/ext-all.css" />

    <script type="text/javascript" src="../../mfbase/ext/adapter/ext/ext-base.js"></script>
    <script type="text/javascript" src="../../mfbase/ext/ext-all.js"></script>
    <!-- TODO: use this one once migrated
    <script type="text/javascript" src="../../mfbase/release/MapFish.js"></script>
    -->
    <script type="text/javascript" src="../../mfbase/mapfish/MapFish.js"></script>

    <script type="text/javascript">
        dojo.require("mapfish_legacy.widgets.Map");
        dojo.require("mapfish_legacy.widgets.GeoStat.Choropleth");
        dojo.require("mapfish_legacy.widgets.GeoStat.ProportionalSymbol");
        dojo.require("mapfish_legacy.widgets.tree.TreeContainer");
        dojo.require("dijit.TitlePane");
      
        function worldFactbkCreateMap(mapDiv){
            var map = new OpenLayers.Map(mapDiv);


            var jpl_wms = new OpenLayers.Layer.WMS("Satellite",
                                               "http://labs.metacarta.com/wms-c/Basic.py?", 
                                               {layers: 'satellite', format: 'image/png'} );
            map.addLayer(jpl_wms);

            var vmap0 = new OpenLayers.Layer.WMS("OpenLayers WMS",
                "http://labs.metacarta.com/wms/vmap0", {layers: 'basic'}, {buffer: 0});

            map.addLayer(vmap0);
            map.setCenter(new OpenLayers.LonLat(17, 2), 2);

            initExt(map);

            return map;
        }
    </script>
    <script type="text/javascript">
    
    // reference local blank image
    Ext.BLANK_IMAGE_URL = '../../mfbase/ext/resources/images/default/s.gif';
  
    // This will be replaced by Ext.onReady()
    function initExt(map) {
        var tree = new mapfish.widgets.LayerTree({map: map, el: 'tree', 
                                                  showWmsLegend: true});
        tree.render();
    };
    </script>

    <style type="text/css">
        @import "../../cwbase/dijit/themes/tundra/tundra.css";
        @import "../../base.css";

        #right {
          position: absolute;
          left: 680px;
        }
        #tree {
          height: 100px;
        }
        
        /* ColorPalette buttons */
        #choroplethWidget .dijitButtonNode {padding: 0px;}
        
        #choroplethWidget .dijitDropDownButton {margin: 0 5px;}
    </style>
  </head>
  <body class="tundra">
    <div id="header"><a href="../"><img id="header-logo" src="../../mapfish.png"/></a></div>
    <h1 class="page-title">MapFish GeoStat demo</h1>

    <div id="content">
      <div id="right">
        <div dojoType="dijit.TitlePane" title="Layers tree" style="width: 260px">
          <div id="tree"></div>
        </div>

        <div dojoType="dijit.TitlePane" title="Choropleth" open="false" style="width: 260px">
          <div dojoType="mapfish_legacy.widgets.GeoStat.Choropleth"
               idAttribute="country"
               indicators="['birth_rt', 'death_rt', 'fertility']" 
               geoStatUrl="../../countries"></div>
        </div>
        <div dojoType="dijit.TitlePane" title="Proportional Symbol" open="false" style="width: 260px">
          <div id="geoStat" dojoType="mapfish_legacy.widgets.GeoStat.ProportionalSymbol"
               idAttribute="name" indicators="['population']"
               geoStatUrl="../../cities"></div>
        </div>
      </div>
      <div dojoType="mapfish_legacy.widgets.Map" createMap="worldFactbkCreateMap"></div>
    </div>

  </body>
</html>
